#!/usr/bin/env python3

import os
import requests
from collections import namedtuple

USE_SERVICE = os.getenv('USE_SERVICE', 'aladin')
POLLING_INTERVAL = os.getenv('POLLING_INTERVAL', 3600)
SIMULATE = os.getenv('SIMULATE', False)
LATITUDE = os.getenv('LATITUDE', None)
LONGITUDE = os.getenv('LONGITUDE', None)

ALADIN_URL = 'https://aladinonline.androworks.org/get_data.php?latitude={latitude}&longitude={longitude}'
OPENWEATHERMAP_URL = 'https://api.openweathermap.org/data/3.0/onecall?lat={latitude}&lon={longitude}&exclude=minutely,daily,alerts&appid={api_key}'
OPENWEATHERMAP_API_KEY = os.getenv('OPENWEATHERMAP_API_KEY', None)

HourlyData = namedtuple('HourlyData', [
    'temp',
    'precip',
    'wind',
    'wind_direction',
    'clouds',
    'rh',
    'pressure',
])


def get_aladin_data():
    if SIMULATE:
        js = {'forecastTime': 'Sep 16, 2022 6:00:00 AM', 'forecastTimeIso': '2022-09-16 08:00:00', 'parameterValues': {'WIND_DIRECTION': [80.11989, 77.961395, 74.039276, 66.225075, 63.50338, 78.12662, 126.0716, 134.27576, 157.00366, 130.93799, 124.08406, 131.86531, 145.11563, 75.89922, 85.35535, 91.52149, 89.381996, 88.86335, 88.77797, 83.86484, 75.53285, 33.99796, 34.03559, 21.3459, 107.191925, 118.86608, 103.820404, 95.5003, 122.01082, 133.22694, 119.02632, 116.44669, 119.95795, 116.07399, 123.05139, 119.80146, 132.31686, 143.39056, 134.625, 115.04219, 115.39378, 121.69878, 117.61224, 111.772896, 104.35696, 95.48392, 84.30966, 93.36473, 105.67647, 106.91008, 108.129814, 116.84573, 111.90869, 118.56198, 115.09501], 'CLOUDS_HIGH': [0.8359375, 0.8671875, 0.8515625, 0.9609375, 0.734375, 0.78125, 0.53125, 0.0, 0.12890625, 0.0, 0.0, 0.0, 0.0, 0.796875, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.9140625, 0.9921875, 0.96875, 1.0, 0.1953125, 0.9375, 0.8671875, 0.8515625, 0.640625, 0.4921875, 0.28125, 0.6015625, 0.53125, 0.421875, 0.515625, 0.4921875, 0.2109375, 0.3515625, 0.234375, 0.0234375, 0.0078125, 0.296875, 0.6875, 0.65625, 0.1796875, 0.203125, 0.0703125, 0.2265625, 0.28125, 0.1328125, 0.203125, 0.1796875], 'WIND_GUST_DIRECTION': [80.23482, 77.78353, 74.21556, 69.44813, 67.79058, 63.942043, 130.72798, 134.34589, 153.86145, 145.28407, 129.33925, 128.59628, 134.49338, 93.44663, 70.11767, 88.939835, 93.915, 86.80106, 88.39033, 88.43217, 80.11838, 58.16565, 33.446404, 25.317152, 108.951546, 118.8128, 119.11937, 100.74705, 113.07365, 132.22882, 136.48392, 119.05376, 116.59607, 117.682465, 123.03043, 121.372, 129.5139, 131.29958, 143.79248, 120.26241, 115.296036, 121.74069, 117.58382, 111.70636, 108.64784, 103.37557, 88.117966, 88.71079, 105.720795, 106.86197, 108.86219, 117.64006, 115.49647, 118.691826, 115.10782], 'HUMIDITY': [0.94851595, 0.88491887, 0.8237532, 0.79114133, 0.75152683, 0.72432566, 0.7591005, 0.8354275, 0.8042804, 0.797389, 0.8181122, 0.8369093, 0.84887344, 0.8519545, 0.88788694, 0.8863583, 0.89640707, 0.90989596, 0.9179634, 0.93830544, 0.96975684, 0.986284, 0.98754716, 0.98794824, 0.92856675, 0.845248, 0.8005709, 0.7450933, 0.7257013, 0.7041671, 0.7213616, 0.6953366, 0.6810558, 0.6516013, 0.65102285, 0.6971033, 0.7399071, 0.8515199, 0.8022503, 0.7743285, 0.7813852, 0.74785244, 0.77224654, 0.7729743, 0.7740763, 0.7625352, 0.8415896, 0.87511754, 0.83988494, 0.8224401, 0.80493224, 0.87766093, 0.8909416, 0.8725123, 0.82237804], 'PRECIPITATION_TOTAL': [0.0, 0.0, 0.0, 0.0, 0.0, 0.00926314, 0.0, 0.0, 0.013258934, 0.0007171631, 0.0014638901, 7.43866e-05, -6.67572e-05, -0.0006875992, 0.0012645721, -0.0009651184, 0.0013036728, 0.0003604889, -0.0015268326, 0.00094509125, 0.00039100647, -0.0010786057, 0.0020151138, -0.0019865036, 0.0008497238, -0.0002002716, 0.0015172958, -0.0007724762, 0.0011920929, -0.00033950806, 0.0013484955, -0.00054359436, 0.003829956, 0.0034122467, -0.0011711121, -0.0006790161, 0.0035209656, 0.022302628, 0.0100488365, 0.0020121783, 0.0020232797, 0.0020122528, 0.0020123124, 8.9854e-06, 0.0020028055, 1.1369586e-05, 0.039407283, 0.13646318, 0.104351014, 0.08156958, 0.019498348, 0.3766821, 0.5208146, 0.034450293, 0.09356642], 'WIND_SPEED': [1.1527255, 1.657969, 2.331003, 2.2491932, 2.657691, 1.7798141, 1.4375867, 3.839108, 3.7068923, 3.5049114, 1.8024226, 1.9025596, 1.3885102, 2.3763065, 2.454665, 2.4785914, 2.3068168, 2.4219344, 1.9658103, 1.4974378, 1.5338559, 1.6111311, 1.7512492, 0.96769685, 1.2849331, 3.1536968, 3.6580722, 3.6566467, 4.512115, 4.7251935, 4.5274916, 4.409813, 3.6177456, 3.869578, 5.75613, 5.7174263, 6.5848975, 4.827013, 3.127713, 4.342205, 4.4467397, 5.147264, 5.3153553, 5.5955563, 5.656717, 5.096918, 4.8129196, 4.809681, 5.639593, 6.6121616, 6.5093765, 7.112881, 6.8301826, 7.3429904, 7.981338], 'APPARENT_TEMPERATURE': [10.690582, 11.581549, 12.240728, 13.334478, 13.488971, 14.436773, 14.817535, 12.265631, 11.728033, 11.640387, 12.955328, 12.155279, 12.01651, 11.406012, 10.865484, 10.280523, 9.330816, 8.563482, 8.153326, 8.301666, 6.855231, 6.1308656, 5.607184, 5.935211, 7.2799377, 7.822955, 8.379889, 9.61817, 8.760651, 9.453278, 8.793121, 10.3190975, 10.763922, 11.189215, 8.66153, 7.480133, 5.44776, 6.7342834, 8.388141, 7.5495667, 7.454352, 6.116852, 5.4095764, 3.952301, 3.6585999, 4.71817, 4.5990295, 4.626129, 4.039459, 2.8593812, 3.1897035, 3.4206605, 3.3977113, 3.9521546, 3.4057188], 'PRESSURE': [100841.56, 100830.875, 100847.75, 100848.875, 100829.56, 100760.94, 100734.81, 100714.75, 100703.375, 100703.56, 100675.81, 100688.25, 100679.44, 100737.06, 100734.5, 100785.75, 100843.56, 100850.25, 100846.75, 100838.125, 100835.69, 100793.25, 100771.44, 100810.875, 100811.56, 100791.25, 100764.94, 100703.125, 100759.75, 100716.06, 100742.75, 100664.94, 100595.44, 100574.25, 100563.81, 100588.625, 100624.375, 100665.25, 100690.81, 100722.0, 100746.69, 100731.375, 100708.81, 100690.75, 100675.31, 100660.19, 100661.25, 100685.875, 100726.625, 100783.75, 100784.25, 100808.375, 100824.19, 100842.56, 100844.125], 'WIND_GUST_SPEED': [2.447917, 3.5445068, 5.1168175, 4.993353, 5.763705, 5.602398, 4.81984, 7.8917284, 9.923133, 7.5377474, 6.988959, 3.5648482, 3.7838943, 4.890781, 5.0558543, 5.339162, 4.9689426, 4.8268948, 4.726501, 3.6036665, 2.8116245, 2.4502273, 2.9806864, 3.751512, 2.5992658, 6.512405, 7.8221, 7.603205, 10.273708, 9.8839, 10.364466, 9.273449, 9.018896, 8.592427, 11.673316, 12.15843, 13.669643, 14.672097, 9.672756, 8.945535, 8.973379, 10.394123, 10.706842, 11.252316, 12.0885725, 11.696654, 10.361783, 9.981553, 11.404712, 13.416247, 13.502273, 15.698515, 14.62873, 15.200451, 16.19825], 'PRECIPITATION_SNOW': [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], 'TEMPERATURE': [11.190582, 12.681549, 13.340729, 14.434479, 15.288971, 15.536774, 15.317535, 14.865631, 14.328033, 14.240387, 14.055328, 13.25528, 12.51651, 12.506012, 11.965485, 11.380524, 10.430817, 9.663483, 9.253326, 8.801666, 7.9552307, 7.2308655, 6.707184, 6.435211, 7.7799377, 9.622955, 10.979889, 12.21817, 12.260651, 12.953278, 12.293121, 12.919098, 13.363922, 13.789215, 13.16153, 11.980133, 11.04776, 10.234283, 10.188141, 10.149567, 10.054352, 9.616852, 8.909576, 8.452301, 8.1586, 8.21817, 8.09903, 8.126129, 8.539459, 8.459381, 8.789703, 9.02066, 8.997711, 9.552155, 10.205719], 'CLOUDS_LOW': [0.125, 0.6484375, 0.1640625, 0.4296875, 0.6328125, 0.96875, 0.9765625, 0.546875, 0.0625, 0.296875, 0.1953125, 0.046875, 0.8359375, 0.9375, 0.609375, 0.71875, 0.015625, 0.5078125, 0.4296875, 0.1796875, 0.1640625, 0.0, 0.0078125, 0.515625, 0.0, 0.0, 0.1328125, 0.9375, 0.6953125, 0.84375, 0.484375, 0.140625, 0.0703125, 0.9140625, 0.21875, 0.421875, 0.21875, 0.6953125, 0.7265625, 0.078125, 0.359375, 0.15625, 0.1015625, 0.0078125, 0.1875, 0.515625, 0.96875, 0.9921875, 0.9609375, 0.9921875, 0.9765625, 0.9883272, 0.933655, 0.9610447, 0.7502298], 'CLOUDS_MEDIUM': [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.484375, 0.6640625, 0.7109375, 0.8046875, 0.71875, 0.9921875, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.4375, 0.1015625, 0.984375, 0.9765625, 0.8828125, 0.9609375, 0.7265625, 0.1171875, 0.859375, 0.96875, 0.984375, 0.9765625, 0.984375, 0.7578125, 0.4609375, 0.2421875, 0.046875, 0.453125, 0.6328125, 0.46875, 0.1875, 0.640625, 0.9140625, 1.0, 1.0, 0.9765625, 0.90625], 'CLOUDS_TOTAL': [0.8359375, 0.8671875, 0.8515625, 0.9609375, 0.734375, 0.96875, 0.9765625, 0.546875, 0.578125, 0.75, 0.75, 0.8125, 0.9375, 1.0, 0.609375, 0.71875, 0.015625, 0.5078125, 0.4296875, 0.1796875, 0.1640625, 0.0, 0.0078125, 0.953125, 0.9921875, 0.96875, 1.0000153, 0.94923407, 0.9844669, 0.9808517, 1.0009038, 0.99290746, 0.9460018, 0.99633884, 0.9140625, 0.7578125, 0.9297028, 0.9961244, 0.99618566, 0.984375, 0.99221814, 0.8398897, 0.5235447, 0.2461397, 0.4337163, 0.90625, 0.9921875, 0.9921875, 0.96875, 1.0, 1.0001532, 1.0001991, 1.0002911, 1.0003676, 0.9768229]}, 'forecastLength': 55, 'weatherIconNames': ['wi_day_cloud', 'wi_cloud', 'wi_cloud', 'wi_cloud', 'wi_day_cloud', 'wi_day_cloud', 'wi_cloud', 'wi_night_cloud', 'wi_night_cloud', 'wi_night_cloud', 'wi_night', 'wi_cloud', 'wi_cloud', 'wi_cloud', 'wi_cloud', 'wi_cloud', 'wi_cloud', 'wi_cloud', 'wi_cloud', 'wi_cloud', 'wi_cloud', 'wi_night_cloud', 'wi_cloud', 'wi_cloud_rain_light', 'wi_cloud_rain_light', 'wi_cloud_rain_light', 'wi_cloud_rain_light', 'wi_cloud'], 'rainIntensity5': 4.0, 'rainIntensity4': 2.0, 'rainIntensity3': 0.8, 'rainIntensity2': 0.2, 'rainIntensity1': 0.1, 'minSnowFractionToShowFlakes': 0.8, 'nowCasting': {'nowUtc': '2022-09-16 12:50:00', 'intervalMinutes': 10, 'forecastNowIdx': 6, 'nowIdx': 36, 'moments': [{'rainLevel': 0, 'rainAmountMillimetersPerHour': 0.0}, {'rainLevel': 0, 'rainAmountMillimetersPerHour': 0.0}, {'rainLevel': 0, 'rainAmountMillimetersPerHour': 0.0}, {'rainLevel': 0, 'rainAmountMillimetersPerHour': 0.0}, {'rainLevel': 0, 'rainAmountMillimetersPerHour': 0.0}, {'rainLevel': 0, 'rainAmountMillimetersPerHour': 0.0}, {'rainLevel': 0, 'rainAmountMillimetersPerHour': 0.0}, {'rainLevel': 0, 'rainAmountMillimetersPerHour': 0.0}, {'rainLevel': 0, 'rainAmountMillimetersPerHour': 0.0}, {'rainLevel': 0, 'rainAmountMillimetersPerHour': 0.0}, {'rainLevel': 0, 'rainAmountMillimetersPerHour': 0.0}, {'rainLevel': 0, 'rainAmountMillimetersPerHour': 0.0}, {'rainLevel': 0, 'rainAmountMillimetersPerHour': 0.0}, {'rainLevel': 0, 'rainAmountMillimetersPerHour': 0.0}, {'rainLevel': 0, 'rainAmountMillimetersPerHour': 0.0}, {'rainLevel': 0, 'rainAmountMillimetersPerHour': 0.0}, {'rainLevel': 0, 'rainAmountMillimetersPerHour': 0.0}, {'rainLevel': 0, 'rainAmountMillimetersPerHour': 0.0}, {'rainLevel': 0, 'rainAmountMillimetersPerHour': 0.0}, {'rainLevel': 0, 'rainAmountMillimetersPerHour': 0.0}, {'rainLevel': 0, 'rainAmountMillimetersPerHour': 0.0}, {'rainLevel': 0, 'rainAmountMillimetersPerHour': 0.0}, {'rainLevel': 0, 'rainAmountMillimetersPerHour': 0.0}, {'rainLevel': 0, 'rainAmountMillimetersPerHour': 0.0}, {'rainLevel': 0, 'rainAmountMillimetersPerHour': 0.0}, {'rainLevel': 0, 'rainAmountMillimetersPerHour': 0.0}, {'rainLevel': 0, 'rainAmountMillimetersPerHour': 0.0}, {'rainLevel': 0, 'rainAmountMillimetersPerHour': 0.0}, {'rainLevel': 0, 'rainAmountMillimetersPerHour': 0.0}, {'rainLevel': 0, 'rainAmountMillimetersPerHour': 0.0}, {'rainLevel': 0, 'rainAmountMillimetersPerHour': 0.0}, {'rainLevel': 1, 'rainAmountMillimetersPerHour': 0.06484198}, {'rainLevel': 0, 'rainAmountMillimetersPerHour': 0.0}, {'rainLevel': 0, 'rainAmountMillimetersPerHour': 0.0}, {'rainLevel': 0, 'rainAmountMillimetersPerHour': 0.0}, {'rainLevel': 0, 'rainAmountMillimetersPerHour': 0.0}, {'rainLevel': 0, 'rainAmountMillimetersPerHour': 0.0}, {'rainLevel': 0, 'rainAmountMillimetersPerHour': 0.0}, {'rainLevel': 0, 'rainAmountMillimetersPerHour': 0.0}, {'rainLevel': 0, 'rainAmountMillimetersPerHour': 0.0}, {'rainLevel': 0, 'rainAmountMillimetersPerHour': 0.0}, {'rainLevel': 0, 'rainAmountMillimetersPerHour': 0.0}, {'rainLevel': 0, 'rainAmountMillimetersPerHour': 0.0}]}}
    else:
        resp = requests.get(ALADIN_URL.format(latitude=LATITUDE, longitude=LONGITUDE))
        js = resp.json()
    return {
        'datetime': js['nowCasting']['nowUtc'],
        'hourly': [
            HourlyData(*data)._asdict() for data in zip(
                js['parameterValues']['TEMPERATURE'],
                js['parameterValues']['PRECIPITATION_TOTAL'],
                js['parameterValues']['WIND_SPEED'],
                js['parameterValues']['WIND_DIRECTION'],
                js['parameterValues']['CLOUDS_TOTAL'],
                js['parameterValues']['HUMIDITY'],
                js['parameterValues']['PRESSURE'],
            )
        ]
    }

def get_openweathermap_data():
    if SIMULATE:
        js = {'lat': 49.495, 'lon': 17.4302, 'timezone': 'Europe/Prague', 'timezone_offset': 7200, 'current': {'dt': 1663333622, 'sunrise': 1663302457, 'sunset': 1663347782, 'temp': 290.34, 'feels_like': 289.6, 'pressure': 1006, 'humidity': 57, 'dew_point': 281.76, 'uvi': 1.53, 'clouds': 42, 'visibility': 10000, 'wind_speed': 5.07, 'wind_deg': 253, 'wind_gust': 7.84, 'weather': [{'id': 802, 'main': 'Clouds', 'description': 'scattered clouds', 'icon': '03d'}]}, 'hourly': [{'dt': 1663333200, 'temp': 290.34, 'feels_like': 289.6, 'pressure': 1006, 'humidity': 57, 'dew_point': 281.76, 'uvi': 1.53, 'clouds': 42, 'visibility': 10000, 'wind_speed': 5.07, 'wind_deg': 253, 'wind_gust': 7.84, 'weather': [{'id': 802, 'main': 'Clouds', 'description': 'scattered clouds', 'icon': '03d'}], 'pop': 0.04}, {'dt': 1663336800, 'temp': 290.42, 'feels_like': 289.64, 'pressure': 1006, 'humidity': 55, 'dew_point': 281.31, 'uvi': 0.94, 'clouds': 47, 'visibility': 10000, 'wind_speed': 4.88, 'wind_deg': 262, 'wind_gust': 7.42, 'weather': [{'id': 802, 'main': 'Clouds', 'description': 'scattered clouds', 'icon': '03d'}], 'pop': 0.01}, {'dt': 1663340400, 'temp': 289.7, 'feels_like': 288.93, 'pressure': 1006, 'humidity': 58, 'dew_point': 281.42, 'uvi': 0.43, 'clouds': 56, 'visibility': 10000, 'wind_speed': 4.39, 'wind_deg': 303, 'wind_gust': 7.86, 'weather': [{'id': 803, 'main': 'Clouds', 'description': 'broken clouds', 'icon': '04d'}], 'pop': 0.01}, {'dt': 1663344000, 'temp': 289.01, 'feels_like': 288.24, 'pressure': 1006, 'humidity': 61, 'dew_point': 281.51, 'uvi': 0.21, 'clouds': 67, 'visibility': 10000, 'wind_speed': 3.36, 'wind_deg': 294, 'wind_gust': 7.29, 'weather': [{'id': 803, 'main': 'Clouds', 'description': 'broken clouds', 'icon': '04d'}], 'pop': 0.01}, {'dt': 1663347600, 'temp': 287.36, 'feels_like': 286.56, 'pressure': 1007, 'humidity': 66, 'dew_point': 281.11, 'uvi': 0, 'clouds': 76, 'visibility': 10000, 'wind_speed': 2.19, 'wind_deg': 279, 'wind_gust': 3.07, 'weather': [{'id': 803, 'main': 'Clouds', 'description': 'broken clouds', 'icon': '04d'}], 'pop': 0.08}, {'dt': 1663351200, 'temp': 285.62, 'feels_like': 284.78, 'pressure': 1007, 'humidity': 71, 'dew_point': 280.51, 'uvi': 0, 'clouds': 85, 'visibility': 10000, 'wind_speed': 1.78, 'wind_deg': 291, 'wind_gust': 1.88, 'weather': [{'id': 804, 'main': 'Clouds', 'description': 'overcast clouds', 'icon': '04n'}], 'pop': 0}, {'dt': 1663354800, 'temp': 284.03, 'feels_like': 283.18, 'pressure': 1007, 'humidity': 77, 'dew_point': 280.18, 'uvi': 0, 'clouds': 62, 'visibility': 10000, 'wind_speed': 1.73, 'wind_deg': 283, 'wind_gust': 1.75, 'weather': [{'id': 803, 'main': 'Clouds', 'description': 'broken clouds', 'icon': '04n'}], 'pop': 0}, {'dt': 1663358400, 'temp': 283.29, 'feels_like': 282.42, 'pressure': 1007, 'humidity': 79, 'dew_point': 279.88, 'uvi': 0, 'clouds': 35, 'visibility': 10000, 'wind_speed': 1.88, 'wind_deg': 256, 'wind_gust': 2.35, 'weather': [{'id': 802, 'main': 'Clouds', 'description': 'scattered clouds', 'icon': '03n'}], 'pop': 0}, {'dt': 1663362000, 'temp': 282.56, 'feels_like': 282.06, 'pressure': 1008, 'humidity': 82, 'dew_point': 279.63, 'uvi': 0, 'clouds': 26, 'visibility': 10000, 'wind_speed': 1.56, 'wind_deg': 269, 'wind_gust': 1.75, 'weather': [{'id': 802, 'main': 'Clouds', 'description': 'scattered clouds', 'icon': '03n'}], 'pop': 0}, {'dt': 1663365600, 'temp': 281.98, 'feels_like': 281.98, 'pressure': 1008, 'humidity': 84, 'dew_point': 279.44, 'uvi': 0, 'clouds': 22, 'visibility': 10000, 'wind_speed': 1.02, 'wind_deg': 262, 'wind_gust': 1.19, 'weather': [{'id': 801, 'main': 'Clouds', 'description': 'few clouds', 'icon': '02n'}], 'pop': 0}, {'dt': 1663369200, 'temp': 281.64, 'feels_like': 280.99, 'pressure': 1009, 'humidity': 85, 'dew_point': 279.34, 'uvi': 0, 'clouds': 19, 'visibility': 10000, 'wind_speed': 1.58, 'wind_deg': 213, 'wind_gust': 1.61, 'weather': [{'id': 801, 'main': 'Clouds', 'description': 'few clouds', 'icon': '02n'}], 'pop': 0}, {'dt': 1663372800, 'temp': 281.3, 'feels_like': 280.1, 'pressure': 1009, 'humidity': 87, 'dew_point': 279.27, 'uvi': 0, 'clouds': 17, 'visibility': 10000, 'wind_speed': 2.1, 'wind_deg': 202, 'wind_gust': 2.04, 'weather': [{'id': 801, 'main': 'Clouds', 'description': 'few clouds', 'icon': '02n'}], 'pop': 0}, {'dt': 1663376400, 'temp': 280.96, 'feels_like': 280.26, 'pressure': 1009, 'humidity': 89, 'dew_point': 279.24, 'uvi': 0, 'clouds': 33, 'visibility': 10000, 'wind_speed': 1.54, 'wind_deg': 211, 'wind_gust': 1.62, 'weather': [{'id': 802, 'main': 'Clouds', 'description': 'scattered clouds', 'icon': '03n'}], 'pop': 0}, {'dt': 1663380000, 'temp': 280.85, 'feels_like': 280.85, 'pressure': 1008, 'humidity': 90, 'dew_point': 279.25, 'uvi': 0, 'clouds': 66, 'visibility': 10000, 'wind_speed': 0.69, 'wind_deg': 209, 'wind_gust': 1.05, 'weather': [{'id': 803, 'main': 'Clouds', 'description': 'broken clouds', 'icon': '04n'}], 'pop': 0}, {'dt': 1663383600, 'temp': 280.23, 'feels_like': 279.32, 'pressure': 1009, 'humidity': 92, 'dew_point': 278.97, 'uvi': 0, 'clouds': 46, 'visibility': 10000, 'wind_speed': 1.63, 'wind_deg': 203, 'wind_gust': 1.76, 'weather': [{'id': 802, 'main': 'Clouds', 'description': 'scattered clouds', 'icon': '03n'}], 'pop': 0}, {'dt': 1663387200, 'temp': 280.45, 'feels_like': 280.45, 'pressure': 1008, 'humidity': 91, 'dew_point': 279.1, 'uvi': 0, 'clouds': 58, 'visibility': 10000, 'wind_speed': 0.82, 'wind_deg': 196, 'wind_gust': 1.86, 'weather': [{'id': 803, 'main': 'Clouds', 'description': 'broken clouds', 'icon': '04n'}], 'pop': 0}, {'dt': 1663390800, 'temp': 280.25, 'feels_like': 278.99, 'pressure': 1009, 'humidity': 92, 'dew_point': 279.05, 'uvi': 0, 'clouds': 66, 'visibility': 10000, 'wind_speed': 1.97, 'wind_deg': 185, 'wind_gust': 2.33, 'weather': [{'id': 803, 'main': 'Clouds', 'description': 'broken clouds', 'icon': '04d'}], 'pop': 0}, {'dt': 1663394400, 'temp': 282, 'feels_like': 281.47, 'pressure': 1009, 'humidity': 83, 'dew_point': 279.28, 'uvi': 0.24, 'clouds': 72, 'visibility': 10000, 'wind_speed': 1.52, 'wind_deg': 232, 'wind_gust': 2.94, 'weather': [{'id': 803, 'main': 'Clouds', 'description': 'broken clouds', 'icon': '04d'}], 'pop': 0}, {'dt': 1663398000, 'temp': 283.13, 'feels_like': 282.03, 'pressure': 1008, 'humidity': 75, 'dew_point': 278.97, 'uvi': 0.6, 'clouds': 100, 'visibility': 10000, 'wind_speed': 2.39, 'wind_deg': 285, 'wind_gust': 4.88, 'weather': [{'id': 804, 'main': 'Clouds', 'description': 'overcast clouds', 'icon': '04d'}], 'pop': 0.05}, {'dt': 1663401600, 'temp': 284.11, 'feels_like': 283.09, 'pressure': 1008, 'humidity': 70, 'dew_point': 278.94, 'uvi': 1.2, 'clouds': 100, 'visibility': 10000, 'wind_speed': 4.07, 'wind_deg': 289, 'wind_gust': 6.81, 'weather': [{'id': 804, 'main': 'Clouds', 'description': 'overcast clouds', 'icon': '04d'}], 'pop': 0}, {'dt': 1663405200, 'temp': 283.58, 'feels_like': 282.58, 'pressure': 1008, 'humidity': 73, 'dew_point': 278.97, 'uvi': 1.87, 'clouds': 100, 'visibility': 10000, 'wind_speed': 5.04, 'wind_deg': 309, 'wind_gust': 8.22, 'weather': [{'id': 804, 'main': 'Clouds', 'description': 'overcast clouds', 'icon': '04d'}], 'pop': 0}, {'dt': 1663408800, 'temp': 283.68, 'feels_like': 282.69, 'pressure': 1008, 'humidity': 73, 'dew_point': 279.07, 'uvi': 1.36, 'clouds': 100, 'visibility': 10000, 'wind_speed': 4.88, 'wind_deg': 303, 'wind_gust': 7.7, 'weather': [{'id': 804, 'main': 'Clouds', 'description': 'overcast clouds', 'icon': '04d'}], 'pop': 0}, {'dt': 1663412400, 'temp': 284.63, 'feels_like': 283.69, 'pressure': 1008, 'humidity': 71, 'dew_point': 279.54, 'uvi': 1.45, 'clouds': 100, 'visibility': 10000, 'wind_speed': 5.03, 'wind_deg': 306, 'wind_gust': 6.64, 'weather': [{'id': 804, 'main': 'Clouds', 'description': 'overcast clouds', 'icon': '04d'}], 'pop': 0}, {'dt': 1663416000, 'temp': 285.36, 'feels_like': 284.44, 'pressure': 1008, 'humidity': 69, 'dew_point': 279.88, 'uvi': 1.3, 'clouds': 100, 'visibility': 10000, 'wind_speed': 5.6, 'wind_deg': 316, 'wind_gust': 6.67, 'weather': [{'id': 804, 'main': 'Clouds', 'description': 'overcast clouds', 'icon': '04d'}], 'pop': 0}, {'dt': 1663419600, 'temp': 285.61, 'feels_like': 284.66, 'pressure': 1008, 'humidity': 67, 'dew_point': 279.76, 'uvi': 1.46, 'clouds': 100, 'visibility': 10000, 'wind_speed': 5.19, 'wind_deg': 318, 'wind_gust': 6.14, 'weather': [{'id': 804, 'main': 'Clouds', 'description': 'overcast clouds', 'icon': '04d'}], 'pop': 0.17}, {'dt': 1663423200, 'temp': 285.95, 'feels_like': 284.98, 'pressure': 1007, 'humidity': 65, 'dew_point': 279.51, 'uvi': 0.89, 'clouds': 100, 'visibility': 10000, 'wind_speed': 5.13, 'wind_deg': 316, 'wind_gust': 6.68, 'weather': [{'id': 804, 'main': 'Clouds', 'description': 'overcast clouds', 'icon': '04d'}], 'pop': 0.26}, {'dt': 1663426800, 'temp': 285.29, 'feels_like': 284.44, 'pressure': 1007, 'humidity': 72, 'dew_point': 280.34, 'uvi': 0.41, 'clouds': 100, 'visibility': 10000, 'wind_speed': 5.23, 'wind_deg': 310, 'wind_gust': 7.27, 'weather': [{'id': 500, 'main': 'Rain', 'description': 'light rain', 'icon': '10d'}], 'pop': 0.36, 'rain': {'1h': 0.18}}, {'dt': 1663430400, 'temp': 283.9, 'feels_like': 283.15, 'pressure': 1007, 'humidity': 81, 'dew_point': 280.83, 'uvi': 0.17, 'clouds': 100, 'visibility': 10000, 'wind_speed': 5.3, 'wind_deg': 309, 'wind_gust': 9.8, 'weather': [{'id': 500, 'main': 'Rain', 'description': 'light rain', 'icon': '10d'}], 'pop': 0.56, 'rain': {'1h': 0.15}}, {'dt': 1663434000, 'temp': 283.52, 'feels_like': 282.7, 'pressure': 1007, 'humidity': 80, 'dew_point': 280.33, 'uvi': 0, 'clouds': 100, 'visibility': 10000, 'wind_speed': 5.34, 'wind_deg': 306, 'wind_gust': 11.34, 'weather': [{'id': 804, 'main': 'Clouds', 'description': 'overcast clouds', 'icon': '04d'}], 'pop': 0.4}, {'dt': 1663437600, 'temp': 283.22, 'feels_like': 282.37, 'pressure': 1008, 'humidity': 80, 'dew_point': 279.98, 'uvi': 0, 'clouds': 100, 'visibility': 10000, 'wind_speed': 4.8, 'wind_deg': 305, 'wind_gust': 11.34, 'weather': [{'id': 804, 'main': 'Clouds', 'description': 'overcast clouds', 'icon': '04n'}], 'pop': 0.36}, {'dt': 1663441200, 'temp': 283.05, 'feels_like': 280.75, 'pressure': 1008, 'humidity': 79, 'dew_point': 279.61, 'uvi': 0, 'clouds': 100, 'visibility': 10000, 'wind_speed': 4.64, 'wind_deg': 299, 'wind_gust': 11.18, 'weather': [{'id': 804, 'main': 'Clouds', 'description': 'overcast clouds', 'icon': '04n'}], 'pop': 0.45}, {'dt': 1663444800, 'temp': 282.93, 'feels_like': 280.83, 'pressure': 1008, 'humidity': 77, 'dew_point': 279.19, 'uvi': 0, 'clouds': 100, 'visibility': 10000, 'wind_speed': 4.12, 'wind_deg': 302, 'wind_gust': 10.97, 'weather': [{'id': 804, 'main': 'Clouds', 'description': 'overcast clouds', 'icon': '04n'}], 'pop': 0.45}, {'dt': 1663448400, 'temp': 282.59, 'feels_like': 280.62, 'pressure': 1008, 'humidity': 77, 'dew_point': 278.69, 'uvi': 0, 'clouds': 100, 'visibility': 10000, 'wind_speed': 3.68, 'wind_deg': 308, 'wind_gust': 10.08, 'weather': [{'id': 804, 'main': 'Clouds', 'description': 'overcast clouds', 'icon': '04n'}], 'pop': 0.35}, {'dt': 1663452000, 'temp': 282.32, 'feels_like': 280.38, 'pressure': 1008, 'humidity': 76, 'dew_point': 278.46, 'uvi': 0, 'clouds': 100, 'visibility': 10000, 'wind_speed': 3.51, 'wind_deg': 305, 'wind_gust': 10.14, 'weather': [{'id': 804, 'main': 'Clouds', 'description': 'overcast clouds', 'icon': '04n'}], 'pop': 0.34}, {'dt': 1663455600, 'temp': 282.09, 'feels_like': 280.16, 'pressure': 1009, 'humidity': 75, 'dew_point': 277.96, 'uvi': 0, 'clouds': 100, 'visibility': 10000, 'wind_speed': 3.4, 'wind_deg': 294, 'wind_gust': 9.18, 'weather': [{'id': 804, 'main': 'Clouds', 'description': 'overcast clouds', 'icon': '04n'}], 'pop': 0.34}, {'dt': 1663459200, 'temp': 281.07, 'feels_like': 279.11, 'pressure': 1009, 'humidity': 79, 'dew_point': 277.59, 'uvi': 0, 'clouds': 100, 'visibility': 10000, 'wind_speed': 3.08, 'wind_deg': 291, 'wind_gust': 8.22, 'weather': [{'id': 804, 'main': 'Clouds', 'description': 'overcast clouds', 'icon': '04n'}], 'pop': 0.34}, {'dt': 1663462800, 'temp': 280.3, 'feels_like': 277.83, 'pressure': 1009, 'humidity': 81, 'dew_point': 277.34, 'uvi': 0, 'clouds': 100, 'visibility': 10000, 'wind_speed': 3.67, 'wind_deg': 288, 'wind_gust': 9.75, 'weather': [{'id': 804, 'main': 'Clouds', 'description': 'overcast clouds', 'icon': '04n'}], 'pop': 0}, {'dt': 1663466400, 'temp': 280.03, 'feels_like': 277.15, 'pressure': 1009, 'humidity': 83, 'dew_point': 277.32, 'uvi': 0, 'clouds': 100, 'visibility': 10000, 'wind_speed': 4.32, 'wind_deg': 286, 'wind_gust': 10.86, 'weather': [{'id': 804, 'main': 'Clouds', 'description': 'overcast clouds', 'icon': '04n'}], 'pop': 0.01}, {'dt': 1663470000, 'temp': 279.71, 'feels_like': 277.14, 'pressure': 1009, 'humidity': 85, 'dew_point': 277.41, 'uvi': 0, 'clouds': 100, 'visibility': 10000, 'wind_speed': 3.61, 'wind_deg': 269, 'wind_gust': 8.13, 'weather': [{'id': 804, 'main': 'Clouds', 'description': 'overcast clouds', 'icon': '04n'}], 'pop': 0.11}, {'dt': 1663473600, 'temp': 281.06, 'feels_like': 278.64, 'pressure': 1009, 'humidity': 81, 'dew_point': 278.11, 'uvi': 0, 'clouds': 100, 'visibility': 10000, 'wind_speed': 3.9, 'wind_deg': 258, 'wind_gust': 9.29, 'weather': [{'id': 804, 'main': 'Clouds', 'description': 'overcast clouds', 'icon': '04n'}], 'pop': 0.1}, {'dt': 1663477200, 'temp': 281.78, 'feels_like': 279.01, 'pressure': 1009, 'humidity': 79, 'dew_point': 278.35, 'uvi': 0, 'clouds': 100, 'visibility': 10000, 'wind_speed': 5.05, 'wind_deg': 271, 'wind_gust': 10.36, 'weather': [{'id': 500, 'main': 'Rain', 'description': 'light rain', 'icon': '10d'}], 'pop': 0.31, 'rain': {'1h': 0.11}}, {'dt': 1663480800, 'temp': 281.46, 'feels_like': 277.99, 'pressure': 1009, 'humidity': 79, 'dew_point': 278.14, 'uvi': 0.27, 'clouds': 100, 'visibility': 10000, 'wind_speed': 6.76, 'wind_deg': 276, 'wind_gust': 11.71, 'weather': [{'id': 500, 'main': 'Rain', 'description': 'light rain', 'icon': '10d'}], 'pop': 0.23, 'rain': {'1h': 0.11}}, {'dt': 1663484400, 'temp': 281.45, 'feels_like': 277.86, 'pressure': 1010, 'humidity': 79, 'dew_point': 278.06, 'uvi': 0.49, 'clouds': 100, 'visibility': 10000, 'wind_speed': 7.14, 'wind_deg': 273, 'wind_gust': 13.6, 'weather': [{'id': 500, 'main': 'Rain', 'description': 'light rain', 'icon': '10d'}], 'pop': 0.68, 'rain': {'1h': 0.21}}, {'dt': 1663488000, 'temp': 281.54, 'feels_like': 277.65, 'pressure': 1010, 'humidity': 81, 'dew_point': 278.55, 'uvi': 0.99, 'clouds': 100, 'visibility': 10000, 'wind_speed': 8.3, 'wind_deg': 289, 'wind_gust': 13.19, 'weather': [{'id': 500, 'main': 'Rain', 'description': 'light rain', 'icon': '10d'}], 'pop': 0.65, 'rain': {'1h': 0.13}}, {'dt': 1663491600, 'temp': 281.9, 'feels_like': 278.21, 'pressure': 1010, 'humidity': 78, 'dew_point': 278.32, 'uvi': 1.53, 'clouds': 100, 'visibility': 10000, 'wind_speed': 7.94, 'wind_deg': 294, 'wind_gust': 13.08, 'weather': [{'id': 804, 'main': 'Clouds', 'description': 'overcast clouds', 'icon': '04d'}], 'pop': 0.58}, {'dt': 1663495200, 'temp': 283.55, 'feels_like': 282.4, 'pressure': 1010, 'humidity': 67, 'dew_point': 277.63, 'uvi': 0.22, 'clouds': 98, 'visibility': 10000, 'wind_speed': 7.91, 'wind_deg': 299, 'wind_gust': 11.75, 'weather': [{'id': 804, 'main': 'Clouds', 'description': 'overcast clouds', 'icon': '04d'}], 'pop': 0.57}, {'dt': 1663498800, 'temp': 286.06, 'feels_like': 284.79, 'pressure': 1010, 'humidity': 53, 'dew_point': 276.65, 'uvi': 0.23, 'clouds': 83, 'visibility': 10000, 'wind_speed': 7.97, 'wind_deg': 303, 'wind_gust': 11.33, 'weather': [{'id': 803, 'main': 'Clouds', 'description': 'broken clouds', 'icon': '04d'}], 'pop': 0.53}, {'dt': 1663502400, 'temp': 286.98, 'feels_like': 285.65, 'pressure': 1009, 'humidity': 47, 'dew_point': 275.79, 'uvi': 0.21, 'clouds': 79, 'visibility': 10000, 'wind_speed': 7.23, 'wind_deg': 295, 'wind_gust': 10.73, 'weather': [{'id': 803, 'main': 'Clouds', 'description': 'broken clouds', 'icon': '04d'}], 'pop': 0.56}]}
    else:
        resp = requests.get(OPENWEATHERMAP_URL.format(latitude=LATITUDE, longitude=LONGITUDE, api_key=OPENWEATHERMAP_API_KEY))
        js = resp.json()
    return {
        'datetime': js['hourly'][0]['dt'],
        'hourly': [
            HourlyData(
                data['temp'],
                data.get('rain', {}).get('1h', 0),
                data['wind_speed'],
                data['wind_deg'],
                data['clouds'],
                data['humidity'],
                data['pressure']
            )._asdict() for data in js['hourly']]
    }

if __name__ == '__main__':
    get_data_fn = {
        'aladin': get_aladin_data,
        'openweathermap': get_openweathermap_data,
    }[USE_SERVICE]

    print(get_openweathermap_data())